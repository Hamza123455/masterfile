<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editor with AI Subtitles</title>
    <script type="module">
        import { createFFmpeg, fetchFile } from 'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.9.7/dist/ffmpeg.mjs';
        
        const ffmpeg = createFFmpeg({ log: true });
        
        async function generateSubtitles() {
            const statusText = document.getElementById("status");
            const videoInput = document.getElementById("videoInput").files[0];
            const videoPlayer = document.getElementById("videoPlayer");
            
            if (!videoInput) {
                alert("Please select a video first.");
                return;
            }
            
            statusText.textContent = "Loading FFmpeg...";
            if (!ffmpeg.isLoaded()) {
                await ffmpeg.load();
            }
            
            statusText.textContent = "Extracting audio...";
            const fileName = "input.mp4";
            ffmpeg.FS("writeFile", fileName, await fetchFile(videoInput));
            
            await ffmpeg.run("-i", fileName, "-q:a", "0", "-map", "a", "output.mp3");
            
            statusText.textContent = "Audio extracted. Generating subtitles...";
            
            // Placeholder: AI subtitles integration can be added here.
            // Example: Call an API or process audio with Web Speech API (not built-in in FFmpeg.js)
            
            statusText.textContent = "Subtitles added. Encoding final video...";
            
            await ffmpeg.run("-i", fileName, "-vf", "subtitles=subtitles.srt", "output.mp4");
            
            const data = ffmpeg.FS("readFile", "output.mp4");
            const videoURL = URL.createObjectURL(new Blob([data.buffer], { type: "video/mp4" }));
            videoPlayer.src = videoURL;
            
            const downloadLink = document.createElement("a");
            downloadLink.href = videoURL;
            downloadLink.download = "video_with_subtitles.mp4";
            downloadLink.textContent = "Download Video";
            document.body.appendChild(downloadLink);
            
            statusText.textContent = "Done!";
        }
    </script>
</head>
<body>
    <h2>Video Editor with AI Subtitles</h2>
    
    <input type="file" id="videoInput" accept="video/*">
    <video id="videoPlayer" controls width="500"></video>
    
    <br>
    
    <button onclick="generateSubtitles()">Generate Subtitles</button>
    <p id="status"></p>
</body>
</html>
